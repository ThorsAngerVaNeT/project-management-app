<div class="page-form" *ngIf="user$ | async as user">
  <h1 class="auth-heading">{{ user._id ? 'Edit Profile' : 'Sign Up' }}</h1>

  <div class="password-requirements" i18n="@@passwordRequirements">
    <p>Please provide login (2-20), name and a strong password.</p>
    <p>For your safety password should be:</p>
    <ul>
      <li>at least 8 characters</li>
      <li>both uppercase and lowercase letters</li>
      <li>both letters and numbers</li>
      <li>contain at least one special character, e.g., ! @ # ? ]</li>
    </ul>
  </div>
  <form nz-form class="auth-form" (ngSubmit)="submitForm()" [formGroup]="signUpForm">
    <nz-form-item>
      <nz-form-control [nzErrorTip]="loginErrorTip">
        <nz-input-group nzPrefixIcon="login">
          <input
            type="text"
            nz-input
            formControlName="login"
            placeholder="Login"
            i18n-placeholder="@@loginPlaceholder"
          />
        </nz-input-group>
        <ng-template #loginErrorTip>
          <ng-container *ngIf="login?.hasError('required')" i18n="@@loginRequiredErrorTip"
            >Please provide a login</ng-container
          >
          <ng-container *ngIf="login?.hasError('minlength')" i18n="@@loginMinlengthErrorTip"
            >Login should be at least two characters long</ng-container
          >
          <ng-container *ngIf="login?.hasError('userAlreadyExists')" i18n="@@userAlreadyExistsErrorTip"
            >This user login already exists, please provide a new one</ng-container
          >
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control [nzErrorTip]="nameErrorTip">
        <nz-input-group nzPrefixIcon="user">
          <input type="text" nz-input formControlName="name" placeholder="Name" i18n-placeholder="@@namePlaceholder" />
        </nz-input-group>
        <ng-template #nameErrorTip>
          <ng-container *ngIf="name?.hasError('required')" i18n="@@nameRequiredErrorTip"
            >Please provide a name</ng-container
          >
          <ng-container
            *ngIf="name?.hasError('maxlength') || name?.hasError('minlength')"
            i18n="@@nameMinlengthErrorTip"
            >Name should be 2-20 characters long</ng-container
          >
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control [nzErrorTip]="passwordErrorTip">
        <nz-input-group nzPrefixIcon="lock">
          <input
            type="password"
            nz-input
            formControlName="password"
            placeholder="Password"
            i18n-placeholder="@@passwordPlaceholder"
          />
        </nz-input-group>
        <ng-template #passwordErrorTip>
          <ng-container *ngIf="password?.hasError('required')" i18n="@@passwordRequiredErrorTip"
            >Please provide a password</ng-container
          >
          <ng-container *ngIf="password?.hasError('pattern')" i18n="@@passwordPatternErrorTip"
            >Please check if your password complies with requirements above</ng-container
          >
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <button nz-button nzType="primary" i18n="@@SignUpButton" [nzLoading]="isSaving" [disabled]="!signUpForm.valid">
        {{ user._id ? 'Save' : 'Sign Up' }}
      </button>
    </nz-form-item>
  </form>
  <div class="delete-block" *ngIf="user._id">
    <div i18n="@@deleteUserText">Delete your user account</div>
    <button nz-button nzDanger [nzLoading]="isDeleting" i18n="@@deleteUserButton" (click)="deleteUser()">
      Delete Forever
    </button>
  </div>
</div>
